#!/bin/bash

## Restore the admin user credentials
##
## Usage: ddev restore-admin-user

#ddev-generated

# Load configuration from YAML
CONFIG_FILE="/var/www/html/.ddev/config.kanopi.yaml"
if [ -f "$CONFIG_FILE" ]; then
    WP_ADMIN_USER=$(yq eval '.wordpress.admin_user // "admin"' "$CONFIG_FILE" 2>/dev/null || echo "admin")
    WP_ADMIN_PASS=$(yq eval '.wordpress.admin_pass // "admin"' "$CONFIG_FILE" 2>/dev/null || echo "admin")
    WP_ADMIN_EMAIL=$(yq eval '.wordpress.admin_email // "admin@example.com"' "$CONFIG_FILE" 2>/dev/null || echo "admin@example.com")
else
    WP_ADMIN_USER="admin"
    WP_ADMIN_PASS="admin"
    WP_ADMIN_EMAIL="admin@example.com"
fi

echo "Restoring admin user: $WP_ADMIN_USER"

# Create or update admin user
wp user create "$WP_ADMIN_USER" "$WP_ADMIN_EMAIL" --role=administrator --user_pass="$WP_ADMIN_PASS" --allow-root 2>/dev/null || \
wp user update "$WP_ADMIN_USER" --user_pass="$WP_ADMIN_PASS" --user_email="$WP_ADMIN_EMAIL" --allow-root

echo "Admin user restored successfully!"
echo "Username: $WP_ADMIN_USER"
echo "Password: $WP_ADMIN_PASS"
echo "Email: $WP_ADMIN_EMAIL"