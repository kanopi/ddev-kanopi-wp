#!/bin/bash

## Run npm commands in the web container
##
## Usage: npm <command> [args...]
##        ddev npm install
##        ddev npm run start
##        ddev npm run build

#ddev-generated

# Load configuration from YAML
CONFIG_FILE=".ddev/config.kanopi.yaml"
if [ -f "$CONFIG_FILE" ]; then
    WP_THEME_RELATIVE_PATH=$(yq eval '.theme.relative_path // "wp-content/themes/custom/struts"' "$CONFIG_FILE" 2>/dev/null || echo "wp-content/themes/custom/struts")
else
    WP_THEME_RELATIVE_PATH="wp-content/themes/custom/struts"
fi

# Check if we should run in theme directory
if [ -d "${WP_THEME_RELATIVE_PATH}" ] && [ -f "${WP_THEME_RELATIVE_PATH}/package.json" ]; then
    # Run npm command in theme directory
    ddev exec "cd ${WP_THEME_RELATIVE_PATH} && npm $*"
else
    # Run npm command in project root
    ddev exec "npm $*"
fi